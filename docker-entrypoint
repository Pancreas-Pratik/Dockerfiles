#!/bin/bash

. ~/.bashrc

MACHINE_IP=$(hostname -I | awk 'NR==1 {print $1}')
if [ "x${LAUNCH_SCRIPT_ORIGINAL}" != "x" ]
then
    bash $LAUNCH_SCRIPT_ORIGINAL
fi

echo "-----------------------------------"
echo "     XUbuntu Desktop Container"
echo "           Yuchen Jin"
echo "          ubuntu 18.04"
echo "-----------------------------------"
echo "This is a ubuntu desktop based on VNC server, to understand how to use it, follow these steps:"
echo "    S1: Input the password as the instruction."
echo "    S2: Confirm the password and remember the port used by this VNC session."
echo "        This setting is only required when you first enter the container. If you want to change the password, use \"tigervncpasswd\" to do that."
echo "    S3: Check the host IP address returned from the screen."
echo "    S4: Run \"noVNC\" outside the container by \"$ noVNC IP=... PORT=...\" where \"PORT\" is optional."
echo "    S5: Check the URL returned by noVNC, and use a web browser to connect the desktop URL."
echo "    S6: Input the password which is set in S1."
echo "    S7: Now you would see the desktop has been launched"
echo "    S8: Enjoy your remote desktop. Note that you should not close both the terminal running the container and the default terminal of noVNC screen."
echo "    S9: Use \"xrandr -s 1920x1080\" to choose the resolution as you want."
echo "    S10: Before quit from the docker, remember call \"tigervncserver -kill :1\" (or other port) outside the VNC."
echo ""

echo "---------"
echo "Host IP:"
echo $MACHINE_IP
echo "---------"

echo "VNC settings:"
noVNC --vnc $MACHINE_IP:5901 --listen 6080 &
tigervncserver -name xubuntu -depth 24 -geometry 1920x1080 &

if [[ $# -eq 0 ]]; then
  exec "/bin/bash"
else
  exec "$@"
fi
